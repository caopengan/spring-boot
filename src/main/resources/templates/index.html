<!DOCTYPE html>
<html lang="en" xmlns="http://www.thymeleaf.org" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8"/>
    <link rel="icon" type="image/x-icon" th:href="@{/images/favicon.ico}" />
    <link th:href="@{/css/bootstrap.css}" rel="stylesheet"/>
    <link th:href="@{/css/toastr.min.css}" rel="stylesheet"/>
    <link th:href="@{/css/index.css}" rel="stylesheet"/>
    <title>首页</title>
</head>
<body>
    <nav class="main-navigation">
        <div class="container-fluid">
            <ul class="menu">
                <li class="presentation"><a><img class="logo" src="http://static.ghostchina.com/image/b/46/4f5566c1f7bc28b3f7ac1fada8abe.png" /></a></li>
                <li class="presentation"><a>首页</a></li>
                <li class="presentation"><a>后台</a></li>
                <li class="presentation"><a>用户</a></li>
            </ul>
            <ul class="menu pull-right">
                <li class="presentation" th:if="${session.userName != null}" th:text="${session.userName}"></li>
                <li class="presentation" th:if="${session.userName != null}"><a>退出</a></li>
                <li class="presentation" th:unless="${session.userName != null}"><a>登录</a></li>
                <li class="presentation" th:unless="${session.userName != null}"><a target="_blank" href="/register">注册</a></li>
            </ul>
        </div>
    </nav>
    <div class="container-fluid" id="container">
        <div class="content">
            <div class="row">
                <div class="col-lg-12">
                    <table class="table table-hover">
                        <thead>
                        <th>编号</th>
                        <th>姓名</th>
                        <th>性别</th>
                        <th>年龄</th>
                        <th>地址</th>
                        </thead>
                        <tbody>
                        <tr th:each="user : ${userList}">
                            <td th:text="${user.id}"></td>
                            <td th:text="${user.name}"></td>
                            <td th:text="${user.sex}"></td>
                            <td th:text="${user.age}"></td>
                            <td th:text="${user.address}"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <!--<h1>我是首页</h1>
    <p th:text="${msg}">3333</p>
    <p th:text="${msg}">3333</p>
    <div  id="head">
        webSocket消息推送
    </div>
    <div  id="msg">
    </div>-->
</body>
<script type="text/javascript" th:src="@{/js/jquery-3.2.1.min.js}"></script>
<script type="text/javascript" th:src="@{/js/bootstrap.js}"></script>
<script type="text/javascript" th:src="@{/js/toastr.min.js}"></script>
<script type="text/javascript" th:src="@{/js/jquery.pjax.js}"></script>
<!--<script type="text/javascript" th:src="@{/js/sockjs-1.1.1.js}"></script>-->
<script type="text/javascript">
    $(function(){
        toastr.options={
                "closeButton":false,//显示关闭按钮
                "debug":false,//启用debug
                "positionClass":"toast-bottom-right",//弹出的位置
                "showDuration":"300",//显示的时间
                "hideDuration":"1000",//消失的时间
                "timeOut":"5000",//停留的时间
                "extendedTimeOut":"1000",//控制时间
                "showEasing":"swing",//显示时的动画缓冲方式
                "hideEasing":"linear",//消失时的动画缓冲方式
                "showMethod":"fadeIn",//显示时的动画方式
                "hideMethod":"fadeOut"//消失时的动画方式
            };

        /*$.pjax({
            url:'',
            selector: 'a',
            container: '#container', //内容替换的容器
            show: 'fade',  //展现的动画，支持默认和fade, 可以自定义动画方式，这里为自定义的function即可。
            cache: true,  //是否使用缓存
            storage: true,  //是否使用本地存储
            titleSuffix: '', //标题后缀
            filter: function(){},
            callback: function(){}
        });*/

        $(document).pjax('a', '#container');

//        $.pjax({
//            url: '',
//            container: '#container'
//        });

//        $.pjax.reload('#container');

//        $('#register').click(function(){
//            $.pjax({
//                url:'',
//                container: '#container'
//            });
//        });

//        $("#register").click(function(e){
//            if(window.history.pushState) {
//                e.preventDefault(); //不跟随原链接跳转
//                url = $(this).attr('href');
//                $.ajax({
//                    url:url,
//                    type:"GET",
//                    async:true,
//                    success:function(data){
//                        window.history.pushState(null, null, url); //改变URL和添加返回历史
//                        document.title = data.title; //设置标题
//                        $('#container').html(data); //设置内容
//                    }
//                });
//            }
//        });

    });


    function initWebSocket(){
        var websocket;
        if ('WebSocket' in window) {
            websocket = new WebSocket("ws://localhost:8080/veg");
        } else if ('MozWebSocket' in window) {
            websocket = new MozWebSocket("ws://veg");
        } else {
            websocket = new SockJS("http://localhost:8080/com/veg");
        }
        websocket.onopen = function (evnt) {
//            $("#head").html("连接服务器成功!");
//            send();
        };
        websocket.onmessage = function (evnt) {
            toastr.info(evnt.data);
//            $("#msg").html($("#msg").html() + "<br/>" + evnt.data);
        };
        websocket.onerror = function (evnt) {
        };
        websocket.onclose = function (evnt) {
//            $("#head").html("与服务器断开了链接!");
        }
        function send(msg){
            if (websocket != null) {
                websocket.send(msg);
            } else {
//                alert('未与服务器链接.');
                toastr.error("未与服务器链接");
            }
        }
    }


</script>
</html>